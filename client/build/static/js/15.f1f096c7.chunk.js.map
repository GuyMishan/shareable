{"version":3,"sources":["_services/chatService.js","actions/chatActions.js","reusable/ReusableUtils.js","_helpers/MediaHandler.js","MessengerPage/MessengerSidePanel.js","MessengerPage/MessengerInput.js","MessengerPage/CallingModal.js","MessengerPage/Messages.js","MessengerPage/MessengerContent.js","MessengerPage/MessengerPage.js"],"names":["chatService","getChatRooms","requestOptions","method","headers","Content-Type","Authorization","JSON","parse","localStorage","getItem","token","fetch","then","handleResponse","res","getMessagesForRoom","room","body","stringify","Object","objectSpread","sendMessage","params","sendImage","data","readMessages","call","answer","response","text","ok","status","removeItem","window","location","reload","error","message","statusText","Promise","reject","chatActions","typing","roomId","dispatch","type","chatConstants","TYPING","stoppedTyping","STOPPED_TYPING","changeRoom","CHANGE_ROOM","GET_ROOMS_REQUEST","rooms","GET_ROOMS_SUCCESS","forEach","_id","INIT_MESSAGE_ARRAY","console","log","initialFetch","GET_MESSAGES_INITIAL_REQUEST","GET_MESSAGES_REQUEST","request","messages","reverse","GET_MESSAGES_SUCCESS","SEND_MESSAGE_REQUEST","sent","SEND_MESSAGE_SUCCESS","newMessage","NEW_MESSAGE","success","INC_MESSAGE_COUNT","messageIds","READ_MESSAGES","read","changeActivityStatus","user","CHANGE_ACTIVITY_STATUS","imageMessageRequest","NEW_IMAGE_MESSAGE_REQUEST","OPEN_CALLING_MODAL","endCall","CLOSE_CALLING_MODAL","endAnsweringCall","CLOSE_ANSWERING_MODAL","searchUsers","SEARCH_USERS","base64StringtoFile","base64String","filename","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","extractImageFileExtensionFromBase64","base64Data","substring","indexOf","image64toCanvasRef","canvasRef","image64","pixelCrop","canvas","width","height","ctx","getContext","image","Image","src","onload","drawImage","x","y","__webpack_require__","d","__webpack_exports__","MediaHandler","C_Users_home_Desktop_social_network_master_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","stream","C_Users_home_Desktop_social_network_master_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__","key","value","_this","resolve","rej","navigator","mediaDevices","getUserMedia","video","audio","catch","err","Error","getTracks","track","stop","MessengerSidePanel","componentDidMount","props","handleSearch","e","_this$props","users","filter","members","member","firstName","toLocaleLowerCase","includes","target","lastName","_this2","_this$props2","searchedRooms","usersList","map","lastMessage","sender","messageType","react_default","a","createElement","className","onClick","concat","activityStatus","profilePicture","alt","id","aria-hidden","htmlFor","placeholder","onChange","Component","connectedMessengerSidePanel","connect","state","chat","imageMaxSize","acceptedFileTypes","acceptedFileTypesArray","item","trim","MessengerInput","classCallCheck","possibleConstructorReturn","getPrototypeOf","sendTypingStatus","socket","_this$props$chat","currentRoom","emit","userId","handleChange","_this$props2$chat","debouncedTyping","clearTimeout","timer","setState","setTimeout","addEmoji","emoji","native","handleSubmit","preventDefault","_this$props3","_this$props3$chat","receiver","uuid","toggleEmojiPicker","showPicker","handleFileSelect","event","_this$props4","_this$props4$chat","files","verifyFile","currentFile","myFileItemReader","FileReader","addEventListener","myResult","result","myFilename","myNewFile","fd","FormData","uniqueId","append","name","readAsDataURL","currentFileType","currentFileSize","size","alertActions","throttle","display","style","justifyItems","dist_es","onSelect","onSubmit","accept","multiple","connectedMessengerInput","CallingModal","handleOpen","mediaHandler","getPremissions","hasMedia","peer","Peer","initiator","trickle","on","userVideo","srcObject","play","signal","webRtc","stopRecoring","myVideo","handleClose","destroy","callingModal","Modal","open","trigger","Content","ref","Actions","Button","negative","connectedCallingModal","dayjs","extend","relativeTime","hashtag","linkify","mention","linkifyOptions","formatHref","href","attributes","url","ShowImage","_ref","show","MessengerMessages","_ref2","picture","backgroundColor","color","border","wordWrap","linkifyjs_react_default","options","Popup","content","createdAt","fromNow","borderRadius","objectFit","photo","MessengerContent","handleScrollToBottom","componentDidUpdate","scrollToBottom","animateScroll","containerId","duration","delay","fetchMessages","lastId","messagesContainer","React","createRef","current","scrollHeight","scrollTop","clientHeight","loadedMessages","Messages","initialMessagesFetchig","Dimmer","active","Loader","Label","basic","pointing","fluid","disabled","messageFetching","loading","isTyping","connectedMessengerContent","MessengerPage","document","title","connectedMessengerPage"],"mappings":"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","file":"static/js/15.f1f096c7.chunk.js","sourcesContent":["export const chatService = {\n  getChatRooms,\n  getMessagesForRoom,\n  sendMessage,\n  sendImage,\n  readMessages,\n  call,\n  answer\n};\n\nfunction logout() {\n  // remove user from local storage to log user out\n  localStorage.removeItem(\"user\");\n}\n\nfunction getChatRooms() {\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: JSON.parse(localStorage.getItem(\"user\")).token\n    }\n  };\n\n  return fetch(\"/api/chat/getChatRooms/\", requestOptions)\n    .then(handleResponse)\n    .then(res => {\n      return res;\n    });\n}\n\nfunction readMessages(params) {\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: JSON.parse(localStorage.getItem(\"user\")).token\n    },\n    body: JSON.stringify({\n      ...params\n    })\n  };\n\n  return fetch(\"/api/chat/readMessages/\", requestOptions)\n    .then(handleResponse)\n    .then(res => {\n      return res;\n    });\n}\n\nfunction getMessagesForRoom(room) {\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: JSON.parse(localStorage.getItem(\"user\")).token\n    },\n    body: JSON.stringify({\n      ...room\n    })\n  };\n\n  return fetch(\"/api/chat/getMessagesForRoom/\", requestOptions)\n    .then(handleResponse)\n    .then(res => {\n      return res;\n    });\n}\n\nfunction sendMessage(params) {\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: JSON.parse(localStorage.getItem(\"user\")).token\n    },\n    body: JSON.stringify({\n      ...params\n    })\n  };\n\n  return fetch(\"/api/chat/sendMessage/\", requestOptions)\n    .then(handleResponse)\n    .then(res => {\n      return res;\n    });\n}\n\nfunction sendImage(data) {\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      Authorization: JSON.parse(localStorage.getItem(\"user\")).token\n    },\n    body: data\n  };\n\n  return fetch(\"/api/chat/sendImage/\", requestOptions)\n    .then(handleResponse)\n    .then(res => {\n      return res;\n    });\n}\n\nfunction call(data) {\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: JSON.parse(localStorage.getItem(\"user\")).token\n    },\n    body: JSON.stringify({\n      ...data\n    })\n  };\n\n  return fetch(\"/api/chat/call/\", requestOptions)\n    .then(handleResponse)\n    .then(res => {\n      return res;\n    });\n}\n\nfunction answer(data) {\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: JSON.parse(localStorage.getItem(\"user\")).token\n    },\n    body: JSON.stringify({\n      ...data\n    })\n  };\n\n  return fetch(\"/api/chat/answer/\", requestOptions)\n    .then(handleResponse)\n    .then(res => {\n      return res;\n    });\n}\n\nfunction handleResponse(response) {\n  return response.text().then(text => {\n    const data = text && JSON.parse(text);\n    if (!response.ok) {\n      if (response.status === 401) {\n        // auto logout if 401 response returned from api\n        logout();\n        window.location.reload(true);\n      }\n\n      const error = (data && data.message) || response.statusText;\n      return Promise.reject(error);\n    }\n\n    return data;\n  });\n}\n","import { chatConstants } from \"../_constants/chatConstants\";\nimport { chatService } from \"../_services/chatService\";\n\nexport const chatActions = {\n  typing,\n  stoppedTyping,\n  changeRoom,\n  getChatRooms,\n  getMessagesForRoom,\n  sendMessage,\n  sendImage,\n  newMessage,\n  readMessages,\n  changeActivityStatus,\n  imageMessageRequest,\n  call,\n  answer,\n  endCall,\n  endAnsweringCall,\n  searchUsers\n};\n\nfunction typing(roomId) {\n  return dispatch => {\n    dispatch({ type: chatConstants.TYPING, roomId });\n  };\n}\n\nfunction stoppedTyping(roomId) {\n  return dispatch => {\n    dispatch({ type: chatConstants.STOPPED_TYPING, roomId });\n  };\n}\n\nfunction initiateMessageArray(roomId) {\n  return { type: chatConstants.INIT_MESSAGE_ARRAY, roomId };\n}\n\nfunction changeRoom(room) {\n  return dispatch => {\n    dispatch({ type: chatConstants.CHANGE_ROOM, room });\n  };\n}\n\nfunction readMessages(params) {\n  const { messageIds, roomId } = params;\n  return dispatch => {\n    dispatch(read(messageIds, roomId));\n    chatService.readMessages(params).then(\n      () => {},\n      error => {\n        console.log(error);\n      }\n    );\n  };\n  function read(messageIds, roomId) {\n    return { type: chatConstants.READ_MESSAGES, messageIds, roomId };\n  }\n}\n\nfunction getChatRooms() {\n  return dispatch => {\n    dispatch(request());\n\n    chatService.getChatRooms().then(\n      response => {\n        dispatch(success(response.rooms));\n\n        response.rooms.forEach(room =>\n          dispatch(initiateMessageArray(room._id))\n        );\n      },\n      error => {\n        console.log(error);\n      }\n    );\n  };\n  function request() {\n    return { type: chatConstants.GET_ROOMS_REQUEST };\n  }\n  function success(rooms) {\n    return { type: chatConstants.GET_ROOMS_SUCCESS, rooms };\n  }\n}\n\nfunction changeActivityStatus(user) {\n  return dispatch => {\n    dispatch({ type: chatConstants.CHANGE_ACTIVITY_STATUS, user });\n  };\n}\n\nfunction getMessagesForRoom(room) {\n  return dispatch => {\n    if (room.initialFetch) {\n      dispatch(initialRequest(room._id));\n    } else {\n      dispatch(request(room._id));\n    }\n    chatService.getMessagesForRoom(room).then(\n      response => {\n        dispatch(\n          success({ messages: response.messages.reverse(), roomId: room._id })\n        );\n      },\n      error => {\n        console.log(error);\n      }\n    );\n  };\n  function request(roomId) {\n    return { type: chatConstants.GET_MESSAGES_REQUEST, roomId };\n  }\n  function initialRequest(roomId) {\n    return { type: chatConstants.GET_MESSAGES_INITIAL_REQUEST, roomId };\n  }\n  function success(data) {\n    return { type: chatConstants.GET_MESSAGES_SUCCESS, data };\n  }\n}\n\nfunction sendMessage(message) {\n  return dispatch => {\n    dispatch(request({ ...message, sent: false }));\n\n    chatService.sendMessage(message).then(\n      response => {\n        dispatch(success(response.message));\n      },\n      error => {\n        console.log(error);\n      }\n    );\n  };\n  function request(message) {\n    return { type: chatConstants.SEND_MESSAGE_REQUEST, message };\n  }\n  function success(message) {\n    return { type: chatConstants.SEND_MESSAGE_SUCCESS, message };\n  }\n}\n\nfunction sendImage(data, message) {\n  return dispatch => {\n    dispatch(request({ ...message, sent: false }));\n\n    chatService.sendImage(data).then(\n      response => {\n        dispatch(success(response.message));\n      },\n      error => {\n        console.log(error);\n      }\n    );\n  };\n  function request(message) {\n    return { type: chatConstants.SEND_MESSAGE_REQUEST, message };\n  }\n  function success(message) {\n    return { type: chatConstants.SEND_MESSAGE_SUCCESS, message };\n  }\n}\n\nfunction newMessage(message) {\n  return dispatch => {\n    dispatch(success(message));\n    dispatch({ type: chatConstants.INC_MESSAGE_COUNT });\n  };\n  function success(message) {\n    return { type: chatConstants.NEW_MESSAGE, message };\n  }\n}\n\nfunction imageMessageRequest(message) {\n  return dispatch => {\n    dispatch(success(message));\n  };\n  function success(message) {\n    return { type: chatConstants.NEW_IMAGE_MESSAGE_REQUEST, message };\n  }\n}\n\nfunction call(data) {\n  return dispatch => {\n    dispatch({ type: chatConstants.OPEN_CALLING_MODAL });\n\n    chatService.call(data).then(\n      () => {},\n      error => {\n        console.log(error);\n      }\n    );\n  };\n}\n\nfunction answer(data) {\n  return dispatch => {\n    chatService.answer(data).then(\n      () => {},\n      error => {\n        console.log(error);\n      }\n    );\n  };\n}\n\nfunction endCall() {\n  return dispatch => {\n    dispatch({ type: chatConstants.CLOSE_CALLING_MODAL });\n  };\n}\n\nfunction endAnsweringCall() {\n  return dispatch => {\n    dispatch({ type: chatConstants.CLOSE_ANSWERING_MODAL });\n  };\n}\n\nfunction searchUsers(rooms) {\n  return dispatch => {\n    dispatch({ type: chatConstants.SEARCH_USERS, rooms });\n  };\n}\n","// A few JavaScript Functions for Images and Files\n// Author: Justin Mitchel\n// Source: https://kirr.co/ndywes\n\n// Convert a Base64-encoded string to a File object\nexport function base64StringtoFile(base64String, filename) {\n  var arr = base64String.split(\",\"),\n    mime = arr[0].match(/:(.*?);/)[1],\n    bstr = atob(arr[1]),\n    n = bstr.length,\n    u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new File([u8arr], filename, { type: mime });\n}\n\n// Download a Base64-encoded file\n\nexport function downloadBase64File(base64Data, filename) {\n  var element = document.createElement(\"a\");\n  element.setAttribute(\"href\", base64Data);\n  element.setAttribute(\"download\", filename);\n  element.style.display = \"none\";\n  document.body.appendChild(element);\n  element.click();\n  document.body.removeChild(element);\n}\n\n// Extract an Base64 Image's File Extension\nexport function extractImageFileExtensionFromBase64(base64Data) {\n  return base64Data.substring(\n    \"data:image/\".length,\n    base64Data.indexOf(\";base64\")\n  );\n}\n\n// Base64 Image to Canvas with a Crop\nexport function image64toCanvasRef(canvasRef, image64, pixelCrop) {\n  const canvas = canvasRef; // document.createElement('canvas');\n  canvas.width = pixelCrop.width;\n  canvas.height = pixelCrop.height;\n  const ctx = canvas.getContext(\"2d\");\n  const image = new Image();\n  image.src = image64;\n  image.onload = function() {\n    ctx.drawImage(\n      image,\n      pixelCrop.x,\n      pixelCrop.y,\n      pixelCrop.width,\n      pixelCrop.height,\n      0,\n      0,\n      pixelCrop.width,\n      pixelCrop.height\n    );\n  };\n}\n","export class MediaHandler {\n  constructor() {\n    this.stream = null;\n  }\n  getPremissions() {\n    return new Promise((resolve, rej) => {\n      navigator.mediaDevices\n        .getUserMedia({ video: true, audio: true })\n        .then(stream => {\n          this.stream = stream;\n          resolve(stream);\n        })\n        .catch(err => {\n          throw new Error(\"Unable to fetch stream \" + err);\n        });\n    });\n  }\n  stopRecoring() {\n    this.stream.getTracks().forEach(function(track) {\n      track.stop();\n    });\n  }\n}\n","import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { chatActions } from \"../actions/chatActions\";\n\nclass MessengerSidePanel extends Component {\n  componentDidMount = () => {\n    const { dispatch } = this.props;\n    dispatch(chatActions.getChatRooms());\n  };\n\n  changeRoom = room => {\n    const { dispatch } = this.props;\n    dispatch(chatActions.changeRoom(room));\n  };\n  //room.members.filter(member => member._id !== user.data._id);\n  handleSearch = e => {\n    const {\n      dispatch,\n      rooms,\n      user: { data }\n    } = this.props;\n    const users = rooms.filter(room => {\n      const user = room.members.filter(member => member._id !== data._id);\n      if (\n        user[0].firstName\n          .toLocaleLowerCase()\n          .includes(e.target.value.toLocaleLowerCase()) ||\n        user[0].lastName\n          .toLocaleLowerCase()\n          .includes(e.target.value.toLocaleLowerCase())\n      ) {\n        return room;\n      }\n      return null;\n    });\n    dispatch(chatActions.searchUsers(users));\n  };\n\n  render() {\n    const { user, rooms, searchedRooms, roomId } = this.props;\n    let renderRooms = searchedRooms ? searchedRooms : rooms;\n    const usersList = renderRooms.map(room => {\n      const member = room.members.filter(\n        member => member._id !== user.data._id\n      );\n      let message = \"...\";\n      if (room.lastMessage[0] && room.lastMessage[0].sender === user.data._id) {\n        if (room.lastMessage[0].messageType === \"text\") {\n          message = \"You: \" + room.lastMessage[0].text;\n        } else {\n          message = \"You sent image \";\n        }\n      } else if (room.lastMessage[0]) {\n        if (room.lastMessage[0].messageType === \"text\") {\n          message = room.lastMessage[0].text;\n        } else {\n          message = \"Image \";\n        }\n      }\n      return (\n        <li\n          className={room._id === roomId ? \"contact active\" : \"contact\"}\n          key={room._id}\n          onClick={() => this.changeRoom({ ...room, user: { ...member[0] } })}\n        >\n          <div className=\"wrap\">\n            <span\n              className={`contact-status ${member[0].activityStatus}`}\n            ></span>\n            <img\n              src={`/images/profile-picture/100x100/${member[0].profilePicture}`}\n              alt=\"\"\n            />\n            <div className=\"meta\">\n              <p className=\"name\">\n                {member[0].firstName + \" \" + member[0].lastName}\n              </p>\n              <p className=\"preview\">{message}</p>\n            </div>\n          </div>\n        </li>\n      );\n    });\n\n    return (\n      <div id=\"sidepanel\">\n        <div id=\"profile\">\n          <div className=\"wrap\">\n            <img\n              id=\"profile-img\"\n              src={`/images/profile-picture/100x100/${user.data.profilePicture}`}\n              className=\"online\"\n              alt=\"\"\n            />\n            <p>{user.data.firstName + \" \" + user.data.lastName}</p>\n            <i\n              className=\"fa fa-chevron-down expand-button\"\n              aria-hidden=\"true\"\n            ></i>\n            <div id=\"status-options\">\n              <ul>\n                <li id=\"status-online\" className=\"active\">\n                  <span className=\"status-circle\"></span>\n                  <p>Online</p>\n                </li>\n                <li id=\"status-offline\">\n                  <span className=\"status-circle\"></span>\n                  <p>Offline</p>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n        <div id=\"search\">\n          <label htmlFor=\"\">\n            <i className=\"fa fa-search\" aria-hidden=\"true\"></i>\n          </label>\n          <input\n            type=\"text\"\n            placeholder=\"Search contacts...\"\n            onChange={this.handleSearch}\n          />\n        </div>\n        <div id=\"contacts\">\n          <ul>{usersList.length ? usersList : \"No users\"}</ul>\n        </div>\n        <div id=\"bottom-bar\">\n          <button id=\"addcontact\">\n            <i className=\"fa fa-user-plus fa-fw\" aria-hidden=\"true\"></i>\n            <span>Add contact</span>\n          </button>\n          <button id=\"settings\">\n            <i className=\"fa fa-cog fa-fw\" aria-hidden=\"true\"></i>\n            <span>Settings</span>\n          </button>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  user: state.user,\n  rooms: state.chat.rooms,\n  searchedRooms: state.chat.searchedRooms,\n  roomId: state.chat.roomId\n});\n\nconst connectedMessengerSidePanel = connect(mapStateToProps)(\n  MessengerSidePanel\n);\nexport { connectedMessengerSidePanel as MessengerSidePanel };\n","import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { chatActions } from \"../actions/chatActions\";\nimport \"emoji-mart/css/emoji-mart.css\";\nimport { Picker } from \"emoji-mart\";\nimport uuid from \"uuid/v4\";\nimport { throttle } from \"throttle-debounce\";\nimport { alertActions } from \"../actions/alertActions\";\nimport {\n  extractImageFileExtensionFromBase64,\n  base64StringtoFile\n} from \"../reusable/ReusableUtils\";\n\nconst imageMaxSize = 10485760; // bytes 10MB\nconst acceptedFileTypes =\n  \"image/x-png, image/png, image/jpg, image/jpeg, image/gif\";\nconst acceptedFileTypesArray = acceptedFileTypes.split(\",\").map(item => {\n  return item.trim();\n});\n\nclass MessengerInput extends Component {\n  constructor() {\n    super();\n\n    this.state = {\n      value: \"\",\n      showPicker: false\n    };\n\n    this.debouncedTyping = throttle(3000, this.sendTypingStatus);\n  }\n\n  componentDidMount() {\n    this.timer = null;\n  }\n\n  sendTypingStatus = () => {\n    const {\n      socket,\n      chat: { roomId, currentRoom }\n    } = this.props;\n    socket.emit(\"typing\", { roomId, userId: currentRoom.user._id });\n  };\n\n  handleChange = e => {\n    const {\n      socket,\n      chat: { roomId, currentRoom }\n    } = this.props;\n    this.debouncedTyping();\n    clearTimeout(this.timer);\n\n    this.setState({ value: e.target.value });\n    this.timer = setTimeout(() => {\n      socket.emit(\"stoppedTyping\", { roomId, userId: currentRoom.user._id });\n    }, 3000);\n  };\n\n  addEmoji = e => {\n    let emoji = e.native;\n    this.setState({\n      value: this.state.value + emoji\n    });\n  };\n\n  handleSubmit = e => {\n    e.preventDefault();\n    const {\n      dispatch,\n      chat: { roomId, currentRoom },\n      userId\n    } = this.props;\n    const { value } = this.state;\n    if (value !== \"\") {\n      dispatch(\n        chatActions.sendMessage({\n          receiver: currentRoom.user,\n          value,\n          roomId,\n          sender: userId,\n          uuid: uuid()\n        })\n      );\n    }\n\n    this.setState({ value: \"\" });\n  };\n\n  toggleEmojiPicker = () => {\n    this.setState({ showPicker: !this.state.showPicker });\n  };\n\n  handleFileSelect = event => {\n    const {\n      dispatch,\n      chat: { roomId, currentRoom },\n      userId\n    } = this.props;\n    const files = event.target.files;\n    if (files && files.length > 0) {\n      const isVerified = this.verifyFile(files);\n      if (isVerified) {\n        // imageBase64Data\n        const currentFile = files[0];\n        const myFileItemReader = new FileReader();\n        myFileItemReader.addEventListener(\n          \"load\",\n          () => {\n            // console.log(myFileItemReader.result)\n            const myResult = myFileItemReader.result;\n            const imgSrcExt = extractImageFileExtensionFromBase64(myResult);\n            const myFilename = \"image.\" + imgSrcExt;\n            const myNewFile = base64StringtoFile(myResult, myFilename);\n            const fd = new FormData();\n            const uniqueId = uuid();\n            fd.append(\"receiver\", JSON.stringify(currentRoom.user));\n            fd.append(\"roomId\", roomId);\n            fd.append(\"uuid\", uniqueId);\n            fd.append(\"photo\", myNewFile, myNewFile.name);\n\n            dispatch(\n              chatActions.sendImage(fd, {\n                receiver: currentRoom.user,\n                value: \"Image\",\n                sender: userId,\n                roomId,\n                uuid: uniqueId\n              })\n            );\n          },\n          false\n        );\n\n        myFileItemReader.readAsDataURL(currentFile);\n      }\n    }\n  };\n\n  verifyFile = files => {\n    if (files && files.length > 0) {\n      const currentFile = files[0];\n      const currentFileType = currentFile.type;\n      const currentFileSize = currentFile.size;\n      const { dispatch } = this.props;\n\n      if (!acceptedFileTypesArray.includes(currentFileType)) {\n        dispatch(\n          alertActions.error(\n            \"This file is not allowed. Only images are allowed.\"\n          )\n        );\n\n        return false;\n      }\n\n      if (currentFileSize > imageMaxSize) {\n        dispatch(\n          alertActions.error(\n            \"This file is not allowed. \" +\n              currentFileSize +\n              \" bytes is too large\"\n          )\n        );\n        return false;\n      }\n      return true;\n    }\n  };\n\n  render() {\n    const { value } = this.state;\n    const display = this.state.showPicker ? \"grid\" : \"none\";\n    return (\n      <div className=\"message-input\">\n        <div\n          style={{\n            display,\n            justifyItems: \"end\"\n          }}\n        >\n          <Picker native={true} onSelect={this.addEmoji} />\n        </div>\n        <div className=\"wrap\">\n          <form onSubmit={this.handleSubmit}>\n            <input\n              onChange={this.handleChange}\n              value={value}\n              type=\"text\"\n              placeholder=\"Write your message...\"\n            />\n          </form>\n          <label>\n            <input\n              type=\"file\"\n              accept={acceptedFileTypes}\n              multiple={false}\n              onChange={this.handleFileSelect}\n            />\n            <i className=\"fa fa-paperclip\" aria-hidden=\"true\"></i>\n          </label>\n\n          <button onClick={this.toggleEmojiPicker}>\n            <i className=\"fa fa-smile-o\" aria-hidden=\"true\"></i>\n          </button>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  chat: state.chat,\n  socket: state.socket.socket,\n  userId: state.user.data._id\n});\n\nconst connectedMessengerInput = connect(mapStateToProps)(MessengerInput);\nexport { connectedMessengerInput as MessengerInput };\n","import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { chatActions } from \"../actions/chatActions\";\nimport { Button, Modal } from \"semantic-ui-react\";\nimport \"emoji-mart/css/emoji-mart.css\";\nimport { MediaHandler } from \"../_helpers/MediaHandler\";\nimport Peer from \"simple-peer\";\n\nclass CallingModal extends Component {\n  constructor() {\n    super();\n\n    this.state = {\n      hasMedia: false\n    };\n\n    this.stream = null;\n    this.mediaHandler = new MediaHandler();\n  }\n\n  handleOpen = () => {\n    const { dispatch, currentRoom, roomId, socket } = this.props;\n    this.mediaHandler\n      .getPremissions()\n      .then(stream => {\n        this.setState({ hasMedia: true });\n        this.stream = stream;\n\n        this.peer = new Peer({\n          initiator: true,\n          stream: stream,\n          trickle: false\n        });\n\n        this.peer.on(\"error\", err => {\n          console.log(err);\n        });\n\n        this.peer.on(\"stream\", stream => {\n          this.userVideo.srcObject = stream;\n          this.userVideo.play();\n        });\n\n        socket.on(\"newAnswer\", data => {\n          this.peer.signal(data.webRtc);\n        });\n\n        this.peer.on(\"signal\", webRtc => {\n          dispatch(chatActions.call({ currentRoom, roomId, webRtc }));\n        });\n\n        this.peer.on(\"close\", () => {\n          this.mediaHandler.stopRecoring();\n          dispatch(chatActions.endCall());\n          this.setState({ hasMedia: false });\n        });\n\n        this.myVideo.srcObject = stream;\n        this.myVideo.play();\n      })\n      .catch(e => console.log(e));\n  };\n\n  handleClose = () => {\n    const { dispatch } = this.props;\n\n    this.peer.destroy();\n\n    this.mediaHandler.stopRecoring();\n    dispatch(chatActions.endCall());\n    this.setState({ hasMedia: false });\n  };\n\n  render() {\n    const { callingModal } = this.props;\n\n    return (\n      <Modal\n        open={callingModal}\n        trigger={\n          <i\n            onClick={this.handleOpen}\n            className=\"fa fa-video-camera\"\n            aria-hidden=\"true\"\n          ></i>\n        }\n      >\n        <Modal.Content>\n          <video\n            style={{\n              width: 300,\n              height: \"auto\"\n            }}\n            ref={ref => {\n              this.myVideo = ref;\n            }}\n          ></video>\n          <video\n            style={{\n              width: 300,\n              height: \"auto\"\n            }}\n            ref={ref => {\n              this.userVideo = ref;\n            }}\n          ></video>\n        </Modal.Content>\n        <Modal.Actions>\n          <Button negative onClick={this.handleClose}>\n            End call\n          </Button>\n        </Modal.Actions>\n      </Modal>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  userId: state.user.data._id,\n  profilePicture: state.user.data.profilePicture,\n  callingModal: state.chat.callingModal,\n  socket: state.socket.socket,\n  currentRoom: state.chat.currentRoom,\n  roomId: state.chat.roomId\n});\n\nconst connectedCallingModal = connect(mapStateToProps)(CallingModal);\nexport { connectedCallingModal as CallingModal };\n","import React from \"react\";\nimport { Popup } from \"semantic-ui-react\";\nimport Linkify from \"linkifyjs/react\";\nimport * as linkify from \"linkifyjs\";\nimport hashtag from \"linkifyjs/plugins/hashtag\";\nimport mention from \"linkifyjs/plugins/mention\";\nimport dayjs from \"dayjs\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\n\ndayjs.extend(relativeTime);\n\nhashtag(linkify);\nmention(linkify);\n\nconst linkifyOptions = {\n  formatHref: function (href, type) {\n    if (type === \"hashtag\") {\n      href = \"/hashtags/\" + href.substring(1);\n    }\n    if (type === \"mention\") {\n      href = \"/\" + href.substring(1);\n    }\n    return href;\n  },\n  attributes: {\n    target: {\n      url: \"_blank\",\n    },\n  },\n};\n\nfunction ShowImage({ show, image }) {\n  return show ? (\n    <img src={`/images/profile-picture/100x100/${image}`} alt=\"\" />\n  ) : (\n    <div></div>\n  );\n}\n\nconst MessengerMessages = ({\n  message,\n  userId,\n  profilePicture,\n  currentRoom,\n}) => {\n  if (message.sender === userId) {\n    if (message.sent === false) {\n      return (\n        <li className=\"replies\" key={message.uuid}>\n          <ShowImage image={profilePicture} show={message.picture}></ShowImage>\n          <p\n            style={{\n              backgroundColor: \"#f5f5f5\",\n              color: \"black\",\n              border: \"1px solid grey\",\n              wordWrap: \"break-word\",\n            }}\n          >\n            <Linkify options={linkifyOptions}>{message.value}</Linkify>\n          </p>\n        </li>\n      );\n    }\n    if (message.messageType === \"text\") {\n      return (\n        <li className=\"replies\">\n          <ShowImage image={profilePicture} show={message.picture}></ShowImage>\n          <Popup\n            content={\n              dayjs(message.createdAt).fromNow() + \", seen:\" + message.read\n            }\n            trigger={\n              <p>\n                <Linkify options={linkifyOptions}>{message.text}</Linkify>\n              </p>\n            }\n          />\n        </li>\n      );\n    } else {\n      return (\n        <li className=\"replies\">\n          <ShowImage image={profilePicture} show={message.picture}></ShowImage>\n          <Popup\n            content={\n              dayjs(message.createdAt).fromNow() + \", seen:\" + message.read\n            }\n            trigger={\n              <img\n                style={{\n                  borderRadius: \"3%\",\n                  objectFit: \"cover\",\n                  width: \"40%\",\n                  height: \"20%\",\n                }}\n                src={`/images/chat-images/${message.photo}`}\n                alt=\"\"\n              />\n            }\n          />\n        </li>\n      );\n    }\n  } else {\n    if (message.sent === false) {\n      return (\n        <li className=\"sent\" key={message.uuid}>\n          <ShowImage\n            image={currentRoom.user.profilePicture}\n            show={message.picture}\n          ></ShowImage>\n          <p\n            style={{\n              backgroundColor: \"#f5f5f5\",\n              color: \"black\",\n              border: \"1px solid grey\",\n              wordWrap: \"break-word\",\n            }}\n          >\n            <Linkify options={linkifyOptions}>{message.value}</Linkify>\n          </p>\n        </li>\n      );\n    }\n    if (message.messageType === \"text\") {\n      return (\n        <li className=\"sent\">\n          <ShowImage\n            image={currentRoom.user.profilePicture}\n            show={message.picture}\n          ></ShowImage>\n\n          <Popup\n            content={\n              dayjs(message.createdAt).fromNow() + \", seen:\" + message.read\n            }\n            trigger={\n              <p>\n                {\" \"}\n                <Linkify options={linkifyOptions}>{message.text}</Linkify>\n              </p>\n            }\n          />\n        </li>\n      );\n    } else {\n      return (\n        <li className=\"sent\">\n          <ShowImage\n            image={currentRoom.user.profilePicture}\n            show={message.picture}\n          ></ShowImage>\n          <Popup\n            content={\n              dayjs(message.createdAt).fromNow() + \", seen:\" + message.read\n            }\n            trigger={\n              <img\n                style={{\n                  borderRadius: \"3%\",\n                  objectFit: \"cover\",\n                  width: \"40%\",\n                  height: \"20%\",\n                }}\n                src={`/images/chat-images/${message.photo}`}\n                alt=\"\"\n              />\n            }\n          />\n        </li>\n      );\n    }\n  }\n};\n\nexport default MessengerMessages;\n","import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { chatActions } from \"../actions/chatActions\";\nimport { MessengerInput } from \"./MessengerInput\";\nimport { Dimmer, Loader, Button, Popup, Label } from \"semantic-ui-react\";\nimport { CallingModal } from \"./CallingModal\";\nimport { animateScroll } from \"react-scroll\";\nimport MessengerMessages from \"./Messages\";\nimport \"emoji-mart/css/emoji-mart.css\";\n\nclass MessengerContent extends Component {\n  constructor() {\n    super();\n\n    this.messagesContainer = React.createRef();\n  }\n\n  componentDidMount = () => {\n    const { dispatch, currentRoom, roomId, userId, content } = this.props;\n\n    if (!content.messages.length) {\n      dispatch(\n        chatActions.getMessagesForRoom({ ...currentRoom, initialFetch: true })\n      );\n    } else {\n      const messageIds = content.messages\n        .filter(message => message.receiver === userId && !message.read)\n        .map(message => message._id);\n      if (messageIds.length) {\n        dispatch(chatActions.readMessages({ messageIds, roomId }));\n      }\n    }\n\n    this.handleScrollToBottom();\n  };\n\n  componentDidUpdate = () => {\n    const { dispatch, roomId, content, userId } = this.props;\n    const messageIds = content.messages\n      .filter(message => message.receiver === userId && !message.read)\n      .map(message => message._id);\n    if (messageIds.length) {\n      dispatch(chatActions.readMessages({ messageIds, roomId }));\n    }\n    this.scrollToBottom();\n  };\n\n  scrollToBottom() {\n    //console.log(this.messagesContainer.current.scrollHeight);\n\n    if (\n      this.messagesContainer.current.scrollHeight -\n        this.messagesContainer.current.scrollTop -\n        this.messagesContainer.current.clientHeight <\n      350\n    ) {\n      animateScroll.scrollToBottom({\n        containerId: \"ContainerElementID\",\n        duration: 200,\n        delay: 0\n      });\n    }\n  }\n\n  handleScrollToBottom = () => {\n    animateScroll.scrollToBottom({\n      containerId: \"ContainerElementID\",\n      duration: 500,\n      delay: 0\n    });\n  };\n\n  fetchMessages = () => {\n    const { dispatch, currentRoom, content } = this.props;\n    const lastId = content.messages[0]._id;\n    dispatch(\n      chatActions.getMessagesForRoom({\n        ...currentRoom,\n        lastId,\n        initialFetch: false\n      })\n    );\n  };\n\n  render() {\n    const { currentRoom, content, userId, profilePicture } = this.props;\n\n    const loadedMessages = currentRoom.messages - content.messages.length;\n    const messages = content.messages.map(message => (\n      <MessengerMessages\n        key={message._id || message.uuid}\n        currentRoom={currentRoom}\n        message={message}\n        userId={userId}\n        profilePicture={profilePicture}\n      ></MessengerMessages>\n    ));\n\n    return (\n      <div className=\"content\">\n        {content.initialMessagesFetchig ? (\n          <Dimmer active>\n            <Loader />\n          </Dimmer>\n        ) : null}\n        <div className=\"contact-profile\">\n          <img\n            src={`/images/profile-picture/100x100/${currentRoom.user.profilePicture}`}\n            alt=\"\"\n          />\n          <p>{currentRoom.user.firstName + \" \" + currentRoom.user.lastName}</p>\n          <div className=\"social-media\">\n            <Popup\n              content=\"Scroll to bottom.\"\n              trigger={\n                <i\n                  onClick={this.handleScrollToBottom}\n                  className=\"fa fa-arrow-down\"\n                  aria-hidden=\"true\"\n                ></i>\n              }\n            />\n\n            <CallingModal></CallingModal>\n            <Label basic color=\"red\" pointing=\"left\">\n              This isn't working.\n            </Label>\n          </div>\n        </div>\n        <div\n          className=\"messages\"\n          id=\"ContainerElementID\"\n          ref={this.messagesContainer}\n        >\n          {loadedMessages ? (\n            <Button\n              fluid\n              disabled={content.messageFetching}\n              loading={content.messageFetching}\n              onClick={this.fetchMessages}\n            >\n              Load {currentRoom.messages - content.messages.length} more\n            </Button>\n          ) : null}\n\n          <ul>\n            {messages}\n            {content.isTyping ? (\n              <li className=\"sent\" key={currentRoom.user._id}>\n                <img\n                  src={`/images/profile-picture/100x100/${currentRoom.user.profilePicture}`}\n                  alt=\"\"\n                />\n                <p>typing...</p>\n              </li>\n            ) : null}\n          </ul>\n        </div>\n        <MessengerInput></MessengerInput>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  userId: state.user.data._id,\n  profilePicture: state.user.data.profilePicture,\n  callingModal: state.chat.callingModal,\n  socket: state.socket.socket,\n  currentRoom: state.chat.currentRoom,\n  roomId: state.chat.roomId\n});\n\nconst connectedMessengerContent = connect(mapStateToProps)(MessengerContent);\nexport { connectedMessengerContent as MessengerContent };\n","import React, { Component } from \"react\";\n\nimport { connect } from \"react-redux\";\n\nimport { MessengerSidePanel } from \"./MessengerSidePanel\";\nimport { MessengerContent } from \"./MessengerContent\";\n\nclass MessengerPage extends Component {\n  componentDidMount = () => {\n    document.title = \"Messages | social-network\";\n  };\n\n  render() {\n    const { chat, roomId } = this.props;\n    return (\n      <div id=\"frame\">\n        <MessengerSidePanel></MessengerSidePanel>\n        {chat.currentRoom ? (\n          <MessengerContent\n            content={chat[roomId]}\n            key={roomId}\n          ></MessengerContent>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  roomId: state.chat.roomId,\n  chat: state.chat\n});\n\nconst connectedMessengerPage = connect(mapStateToProps)(MessengerPage);\nexport { connectedMessengerPage as default };\n"],"sourceRoot":""}